on_actions = {
	on_weekly = {
		effect = {
			ROOT = {
				set_variable = {
					weekly_core_death_count = 0
				}
				set_variable = {
					weekly_occ_death_count = 0
				}
				if = {
					limit = {
						has_dynamic_modifier = {
							modifier = RK_grain_shortage
						}
					}
					add_to_variable = {
						food_shortage_depth = 1
					}
					clamp_variable = {
						var = food_shortage_depth
						max = 52
						min = 0
					}
					set_variable = {
						mean = 26
					}
					set_variable = {
						food_shortage_depth_mult = food_shortage_depth
					}
					clamp_variable = {
						var = food_shortage_depth_mult
						max = mean
						min = 0
					}
					divide_variable = {
						food_shortage_depth_mult = 3
					}
					set_variable = {
						food_shortage_depth_temp2 = food_shortage_depth
					}
					clamp_variable = {
						var = food_shortage_depth_temp2
						max = mean
						min = 0
					}
					multiply_variable = {
						food_shortage_depth_mult = food_shortage_depth_temp2
					}
					multiply_variable = {
						food_shortage_depth_mult = 0.1
					}
					if = {
						limit = {
							check_variable = {
								food_shortage_depth > mean
							}
						}
						set_variable = {
							food_shortage_depth_temp = food_shortage_depth
						}
						divide_variable = {
							food_shortage_depth_temp = 3
						}
						multiply_variable = {
							food_shortage_depth_temp = food_shortage_depth
						}
						multiply_variable = {
							food_shortage_depth_temp = 0.01
						}
						add_to_variable = {
							food_shortage_depth_mult = food_shortage_depth_temp
						}
					}
					########### CORE ##############
					set_variable = {
						core_manpower_multiplier = pcnt_of_core_not_fed
					}
					subtract_from_variable = {
						core_manpower_multiplier = severe_starvation_offset
					}
					clamp_variable = {
						var = core_manpower_multiplier
						max = 0
						min = -2
					}
					multiply_variable = {
						core_manpower_multiplier = core_manpower_multiplier
					}
					multiply_variable = {
						core_manpower_multiplier = core_manpower_multiplier
					}
					multiply_variable = {
						core_manpower_multiplier = food_shortage_depth_mult
					}
					divide_variable = {
						core_manpower_multiplier = -200	# might be a good idea to clamp between -.2 and 0
					}
					clamp_variable = {
						var = core_manpower_multiplier
						min = -1
						max = 0
					}
					########### OCCUPIED ##############
					set_variable = {
						occupied_manpower_multiplier = pcnt_of_occ_not_fed
					}
					subtract_from_variable = {
						occupied_manpower_multiplier = severe_starvation_offset
					}
					clamp_variable = {
						var = occupied_manpower_multiplier
						max = 0
						min = -2
					}
					multiply_variable = {
						occupied_manpower_multiplier = occupied_manpower_multiplier
					}
					multiply_variable = {
						occupied_manpower_multiplier = occupied_manpower_multiplier
					}
					multiply_variable = {
						occupied_manpower_multiplier = food_shortage_depth_mult
					}
					divide_variable = {
						occupied_manpower_multiplier = -200	# might be a good idea to clamp between -.2 and 0
					}
					clamp_variable = {
						var = occupied_manpower_multiplier
						min = -1
						max = 0
					}
					every_controlled_state = {
						if = {
							limit = {
								is_core_of = ROOT
							}
							set_variable = {
								state_manpower_reduction = ROOT.core_manpower_multiplier
							}
							multiply_variable = {
								state_manpower_reduction = state_population_k
							}
							subtract_from_variable = {
								ROOT.weekly_core_death_count = state_manpower_reduction
							}
						}
						else = {
							set_variable = {
								state_manpower_reduction = ROOT.occupied_manpower_multiplier
							}
							multiply_variable = {
								state_manpower_reduction = state_population_k
							}
							subtract_from_variable = {
								ROOT.weekly_occ_death_count = state_manpower_reduction
							}
						}
						add_manpower = state_manpower_reduction
					}
					set_variable = {
						stability_penalty = core_manpower_multiplier
					}
					divide_variable = {
						stability_penalty = 20
					}
					set_variable = {
						compliance_penalty = occupied_manpower_multiplier
					}
					multiply_variable = {
						compliance_penalty = 2
					}
					set_variable = {
						resistance_penalty = compliance_penalty
					}
					divide_variable = {
						resistance_penalty = 10
					}
				}
				else = {
					subtract_from_variable = {
						food_shortage_depth = 6
					}
				}
			}
		}
	}
}
